(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-editor-editor"],{"07a5":function(t,e,i){"use strict";i.r(e);var n=i("8a8b"),o=i.n(n);for(var a in n)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(a);e["default"]=o.a},12843:function(t,e,i){"use strict";var n=i("48ba"),o=i.n(n);o.a},"3b67":function(t,e,i){"use strict";i.r(e);var n=i("d51a"),o=i("07a5");for(var a in o)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return o[t]}))}(a);i("12843");var c=i("f0c5"),r=Object(c["a"])(o["default"],n["b"],n["c"],!1,null,"5663c3c5",null,!1,n["a"],void 0);e["default"]=r.exports},"3f6d":function(t,e,i){var n=i("24fb");e=n(!1),e.push([t.i,'@charset "UTF-8";\r\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\r\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\r\n/* 颜色变量 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.edit-body[data-v-5663c3c5]{padding:%?30?%}.edit-body .title[data-v-5663c3c5]{border-bottom:1px solid #ddd}.edit-body .title uni-input[data-v-5663c3c5]{font-size:%?46?%;height:%?80?%}.edit-body .title .title-input[data-v-5663c3c5]{font-size:%?46?%;color:#bbb;height:80%}.edit-body .content[data-v-5663c3c5]{height:calc(100vh - %?500?%);width:100%;margin-bottom:%?30?%;border-bottom:1px solid #ddd;overflow:auto}.edit-body .content .ql-container[data-v-5663c3c5]{height:100%;overflow:auto}.edit-body .content .ql-container[data-v-5663c3c5] .ql-blank:before{font-size:%?34?%;color:#bbb;text-decoration:none}.edit-body .tools[data-v-5663c3c5]{width:100%;display:flex;align-items:center;justify-content:space-around;position:fixed;bottom:%?100?%;left:0}.edit-body .tools .iconfont[data-v-5663c3c5]{font-size:%?36?%;color:#333}.edit-body .tools .iconfont.active[data-v-5663c3c5]{color:#0199fe}',""]),t.exports=e},"48ba":function(t,e,i){var n=i("3f6d");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var o=i("4f06").default;o("6abdfc47",n,!0,{sourceMap:!1,shadowMode:!1})},"70e9":function(t,e,i){"use strict";i("7a82"),Object.defineProperty(e,"__esModule",{value:!0}),e.getAvatar=function(t){var e,i,n;return null!==(e=null===t||void 0===t||null===(i=t.user_id[0])||void 0===i||null===(n=i.avatar_file)||void 0===n?void 0:n.url)&&void 0!==e?e:""},e.getImgUrl=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,i=[];return t.replace(/<img [^>]*src=['"]([^'"]+)[^>]*>/g,(function(t,e){i.push(e)})),i=i.slice(0,e),i},e.getName=function(t){return t.user_id[0].username||t.user_id[0].username||t.user_id[0].mobile||"请设置昵称"},e.getProvince=function(){return new Promise((function(t,e){var i=uni.getStorageSync("history");i&&Date.now()-i.time>108e5?t(i.province):uni.request({url:"https://restapi.amap.com/v3/ip?key=ebe8a28f9c42f8025a1f4a3bdbc06d93",success:function(e){var i="";i="string"==typeof e.data.province?e.data.province:"未知",t(i);var n={province:i,time:Date.now()};uni.setStorageSync("history",n)},fail:function(t){e(t)}})}))},i("ac1f"),i("5319"),i("14d9"),i("fb6a"),i("d3b7")},"8a8b":function(t,e,i){"use strict";(function(t){i("7a82");var n=i("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("ac1f"),i("baa5"),i("fb6a");var o=n(i("5530")),a=n(i("b85c")),c=n(i("c7eb")),r=n(i("1da1")),s=i("70e9"),d=t.database(),l={data:function(){return{showTools:!1,headShow:!1,boldShow:!1,italicShow:!1,articleObj:{title:"",content:"",desc:"",picUrl:""},editId:""}},onLoad:function(t){null!==t&&void 0!==t&&t.id&&(this.getInfo(t.id),this.editId=t.id),this.getP()},methods:{getInfo:function(t){var e=this;return(0,r.default)((0,c.default)().mark((function i(){return(0,c.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,d.collection("talk-article").doc(t).get({getOne:!0}).then((function(t){e.articleObj=t.result.data,e.editReady(t.result.data)}));case 2:case"end":return i.stop()}}),i)})))()},getP:function(){var t=this;return(0,r.default)((0,c.default)().mark((function e(){var i;return(0,c.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,s.getProvince)();case 2:i=e.sent,t.articleObj.province=i;case 4:case"end":return e.stop()}}),e)})))()},onFocus:function(){this.showTools=!0},editReady:function(t){var e=this;uni.createSelectorQuery().in(this).select("#editor").fields({size:!0,context:!0},(function(i){e.editorCtx=i.context,t&&i.context.setContents({html:t.content})})).exec()},checkStatus:function(t,e,i){e.hasOwnProperty(t)?this[i]=!0:this[i]=!1},onStatuschange:function(t){var e=t.detail;console.log(e),this.checkStatus("header",e,"headShow"),this.checkStatus("bold",e,"boldShow"),this.checkStatus("italic",e,"italicShow")},addDivider:function(){this.editorCtx.insertDivider()},clickHead:function(){this.headShow=!this.headShow,this.editorCtx.format("header",!!this.headShow&&"H2")},clickBold:function(){this.boldShow=!this.boldShow,this.editorCtx.format("bold")},clickItalic:function(){this.italicShow=!this.italicShow,this.editorCtx.format("italic")},insertImage:function(){var e=this;uni.chooseImage({success:function(){var i=(0,r.default)((0,c.default)().mark((function i(n){var o,r,s,d,l,u;return(0,c.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:uni.showLoading({title:"加载中···",mask:!0}),o=(0,a.default)(n.tempFiles),i.prev=2,o.s();case 4:if((r=o.n()).done){i.next=14;break}return s=r.value,d=s.path.substring(s.path.lastIndexOf(".")),l=Date.now()+""+String(Math.random()).substr(3,6)+d,i.next=10,t.uploadFile({filePath:s.path,cloudPath:s.name||l});case 10:u=i.sent,e.editorCtx.insertImage({src:u.fileID});case 12:i.next=4;break;case 14:i.next=19;break;case 16:i.prev=16,i.t0=i["catch"](2),o.e(i.t0);case 19:return i.prev=19,o.f(),i.finish(19);case 22:uni.hideLoading();case 23:case"end":return i.stop()}}),i,null,[[2,16,19,22]])})));return function(t){return i.apply(this,arguments)}}()})},submit:function(){var t=this;this.editorCtx.getContents({success:function(e){t.articleObj.content=e.html,t.articleObj.desc=e.text.slice(0,100),t.articleObj.picUrl=(0,s.getImgUrl)(e.html),uni.showLoading({mask:!0}),t.editId?d.collection("talk-article").doc(t.editId).update({desc:t.articleObj.desc,content:t.articleObj.content,picUrl:t.articleObj.picUrl,title:t.articleObj.title}).then((function(t){uni.hideLoading(),uni.showToast({title:"发布成功",icon:"none"}),setTimeout((function(){uni.reLaunch({url:"/pages/index/index"})}),800)})):d.collection("talk-article").add((0,o.default)({},t.articleObj)).then((function(t){uni.hideLoading(),uni.showToast({title:"发布成功",icon:"none"}),setTimeout((function(){uni.reLaunch({url:"/pages/index/index"})}),800)}))}})}}};e.default=l}).call(this,i("a9ff")["default"])},d51a:function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){}));var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"edit-body"},[i("v-uni-view",{staticClass:"title"},[i("v-uni-input",{attrs:{type:"text",placeholder:"请输入标题","placeholder-class":"title-input"},model:{value:t.articleObj.title,callback:function(e){t.$set(t.articleObj,"title",e)},expression:"articleObj.title"}})],1),i("v-uni-view",{staticClass:"content"},[i("v-uni-editor",{attrs:{placeholder:"请编写内容",id:"editor","show-img-size":!0,"show-img-toolbar":!0,"show-img-resize":!0},on:{ready:function(e){arguments[0]=e=t.$handleEvent(e),t.editReady.apply(void 0,arguments)},focus:function(e){arguments[0]=e=t.$handleEvent(e),t.onFocus.apply(void 0,arguments)},statuschange:function(e){arguments[0]=e=t.$handleEvent(e),t.onStatuschange.apply(void 0,arguments)}}})],1),i("v-uni-button",{attrs:{type:"primary",disabled:!t.articleObj.title.length},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.submit.apply(void 0,arguments)}}},[t._v("发布")]),t.showTools?i("v-uni-view",{staticClass:"tools"},[i("v-uni-text",{staticClass:"iconfont icon-zitibiaoti",class:[t.headShow?"active":""],on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clickHead.apply(void 0,arguments)}}}),i("v-uni-text",{staticClass:"iconfont icon-zitijiacu",class:[t.boldShow?"active":""],on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clickBold.apply(void 0,arguments)}}}),i("v-uni-text",{staticClass:"iconfont icon-zitixieti",class:[t.italicShow?"active":""],on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clickItalic.apply(void 0,arguments)}}}),i("v-uni-text",{staticClass:"iconfont icon-fengexian",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.addDivider.apply(void 0,arguments)}}}),i("v-uni-text",{staticClass:"iconfont icon-charutupian",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.insertImage.apply(void 0,arguments)}}}),i("v-uni-text",{staticClass:"iconfont icon-duigoux",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.showTools=!1}}})],1):t._e()],1)},o=[]}}]);